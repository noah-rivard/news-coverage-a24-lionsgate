{
  "version": 3,
  "sources": ["../src/popup.ts"],
  "sourcesContent": ["function setText(id: string, text: string) {\n  const el = document.getElementById(id);\n  if (el) el.textContent = text;\n}\n\nfunction setStatus(text: string, color = \"inherit\") {\n  const el = document.getElementById(\"status\");\n  if (el) {\n    el.textContent = text;\n    el.style.color = color;\n  }\n}\n\ntype OpenAIResponseIds = Record<string, string[]>;\n\nfunction isHttpUrl(raw: string): boolean {\n  try {\n    const u = new URL(raw);\n    return u.protocol === \"http:\" || u.protocol === \"https:\";\n  } catch {\n    return false;\n  }\n}\n\nfunction deriveServerBase(endpoint: string): string | null {\n  if (!isHttpUrl(endpoint)) return null;\n  const u = new URL(endpoint);\n  const suffixes = [\"/process/articles\", \"/process/article\", \"/ingest/article\"];\n  let basePath = u.pathname;\n  for (const suffix of suffixes) {\n    if (basePath.endsWith(suffix)) {\n      basePath = basePath.slice(0, -suffix.length);\n      break;\n    }\n  }\n  basePath = basePath.replace(/\\/+$/, \"\");\n  return u.origin + basePath;\n}\n\nfunction joinUrl(base: string, path: string): string {\n  const normalizedBase = base.endsWith(\"/\") ? base.slice(0, -1) : base;\n  const normalizedPath = path.startsWith(\"/\") ? path : `/${path}`;\n  return `${normalizedBase}${normalizedPath}`;\n}\n\nasync function getEndpoint(): Promise<string> {\n  const { ingestEndpoint } = await chrome.storage.sync.get({\n    ingestEndpoint: \"http://localhost:8000/process/articles\",\n  });\n  return (ingestEndpoint || \"\").trim() || \"http://localhost:8000/process/articles\";\n}\n\nfunction openUrl(url: string) {\n  chrome.tabs.create({ url }).catch(() => undefined);\n}\n\nfunction formatOpenAIResponseIds(ids?: OpenAIResponseIds): string {\n  if (!ids) return \"\";\n  const keys = Object.keys(ids).sort();\n  const parts: string[] = [];\n  for (const key of keys) {\n    const values = Array.isArray(ids[key]) ? ids[key] : [];\n    if (values.length) {\n      parts.push(`${key}: ${values.join(\", \")}`);\n    }\n  }\n  return parts.join(\"\\n\");\n}\n\nfunction renderSendStatus(\n  status?: { status: string; error?: string; duplicate_of?: string; openai_response_ids?: OpenAIResponseIds },\n) {\n  if (!status) return;\n  setText(\"openai_response_ids\", formatOpenAIResponseIds(status.openai_response_ids));\n  if (status.status === \"ok\") {\n    setStatus(\"Auto-sent to pipeline.\", \"green\");\n  } else if (status.status === \"duplicate\") {\n    setStatus(\"Already processed (duplicate).\", \"orange\");\n  } else if (status.status === \"error\") {\n    setStatus(status.error || \"Send failed.\", \"red\");\n  }\n}\n\nfunction loadLatest() {\n  chrome.runtime.sendMessage({ type: \"GET_LATEST_ARTICLE\" }, (resp) => {\n    const article = resp?.article;\n    if (!article) {\n      setStatus(\"No article scraped yet. Right-click a page or link and choose Capture.\", \"red\");\n      setText(\"openai_response_ids\", \"\");\n      return;\n    }\n    setText(\"title\", article.title || \"(untitled)\");\n    setText(\"source\", article.source || \"Unknown\");\n    setText(\"published\", article.published_at || \"Unknown\");\n    renderSendStatus(resp?.sendStatus);\n    if (!resp?.sendStatus) {\n      setStatus(\"Ready to send.\");\n      setText(\"openai_response_ids\", \"\");\n    }\n  });\n}\n\nasync function bindLinks() {\n  const endpoint = await getEndpoint();\n  const serverBase = deriveServerBase(endpoint);\n  const meta = serverBase ? `Endpoint: ${endpoint}\\nServer base: ${serverBase}` : `Endpoint: ${endpoint}`;\n  setText(\"links_meta\", meta);\n\n  const openEndpointBtn = document.getElementById(\"open_endpoint\");\n  if (openEndpointBtn) {\n    openEndpointBtn.addEventListener(\"click\", () => {\n      if (isHttpUrl(endpoint)) openUrl(endpoint);\n    });\n  }\n\n  const openOptionsBtn = document.getElementById(\"open_options\");\n  if (openOptionsBtn) {\n    openOptionsBtn.addEventListener(\"click\", () => {\n      chrome.runtime.openOptionsPage().catch(() => undefined);\n    });\n  }\n\n  const openOpenAiBtn = document.getElementById(\"open_openai_logs\");\n  if (openOpenAiBtn) {\n    openOpenAiBtn.addEventListener(\"click\", () => {\n      openUrl(\"https://platform.openai.com/logs?api=responses\");\n    });\n  }\n\n  const openReviewBtn = document.getElementById(\"open_review\");\n  if (openReviewBtn) {\n    openReviewBtn.toggleAttribute(\"disabled\", !serverBase);\n    openReviewBtn.addEventListener(\"click\", () => {\n      if (serverBase) openUrl(joinUrl(serverBase, \"/review\"));\n    });\n  }\n\n  const openHealthBtn = document.getElementById(\"open_health\");\n  if (openHealthBtn) {\n    openHealthBtn.toggleAttribute(\"disabled\", !serverBase);\n    openHealthBtn.addEventListener(\"click\", () => {\n      if (serverBase) openUrl(joinUrl(serverBase, \"/health\"));\n    });\n  }\n\n  const openProcessArticlesBtn = document.getElementById(\"open_process_articles\");\n  if (openProcessArticlesBtn) {\n    openProcessArticlesBtn.toggleAttribute(\"disabled\", !serverBase);\n    openProcessArticlesBtn.addEventListener(\"click\", () => {\n      if (serverBase) openUrl(joinUrl(serverBase, \"/process/articles\"));\n    });\n  }\n}\n\nfunction bindSend() {\n  const btn = document.getElementById(\"send\");\n  if (!btn) return;\n  btn.addEventListener(\"click\", () => {\n    setStatus(\"Sending...\");\n    chrome.runtime.sendMessage({ type: \"SEND_TO_INGEST\" }, (resp) => {\n      if (resp?.status === \"ok\") {\n        setStatus(\"Stored via pipeline.\", \"green\");\n      } else if (resp?.status === \"duplicate\") {\n        setStatus(\"Already processed (duplicate).\", \"orange\");\n      } else {\n        setStatus(resp?.error || \"Send failed.\", \"red\");\n      }\n    });\n  });\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  loadLatest();\n  bindLinks();\n  bindSend();\n});\n\n// Listen for background capture failures (e.g., permission denied) and surface them.\nchrome.runtime.onMessage.addListener((message) => {\n  if (message?.type === \"CAPTURE_FAILED\") {\n    setStatus(message.reason || \"Capture failed.\", \"red\");\n  }\n  if (message?.type === \"SEND_RESULT\") {\n    renderSendStatus(message);\n  }\n});\n"],
  "mappings": "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",
  "names": []
}
